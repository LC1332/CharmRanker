<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ê£ÄÊµãÁªìÊûúÂèØËßÜÂåñ - CharmRanker</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Noto+Sans+SC:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --border-color: #30363d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --accent-cyan: #58a6ff;
            --accent-orange: #f0883e;
            --accent-green: #3fb950;
            --accent-purple: #a371f7;
            --face-color: #00e5ff;
            --body-color: #ff9100;
            --backup-face-color: #ff00ff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', 'JetBrains Mono', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ËÉåÊôØË£ÖÈ•∞ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(88, 166, 255, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(240, 136, 62, 0.06) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Â§¥ÈÉ® */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 24px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--face-color), var(--body-color));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .logo h1 {
            font-size: 1.4rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--face-color), var(--body-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .dataset-info {
            display: flex;
            align-items: center;
            gap: 16px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .dataset-badge {
            background: var(--bg-tertiary);
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            font-family: 'JetBrains Mono', monospace;
        }

        /* ‰∏ªË¶ÅÂÜÖÂÆπÂå∫ */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 24px;
        }

        /* ÂõæÁâáÊü•ÁúãÂå∫ */
        .viewer-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
        }

        .viewer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-tertiary);
        }

        .image-path {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-secondary);
            max-width: 500px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .viewer-controls {
            display: flex;
            gap: 8px;
        }

        .toggle-btn {
            padding: 8px 14px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .toggle-btn:hover {
            border-color: var(--text-muted);
        }

        .toggle-btn.active {
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .toggle-btn.face.active {
            border-color: var(--face-color);
            color: var(--face-color);
        }

        .toggle-btn.body.active {
            border-color: var(--body-color);
            color: var(--body-color);
        }

        .toggle-btn.keypoints.active {
            border-color: var(--accent-purple);
            color: var(--accent-purple);
        }

        .toggle-btn.backup-face.active {
            border-color: var(--backup-face-color);
            color: var(--backup-face-color);
        }

        .color-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .color-dot.face { background: var(--face-color); }
        .color-dot.body { background: var(--body-color); }
        .color-dot.keypoints { background: var(--accent-purple); }
        .color-dot.backup-face { background: var(--backup-face-color); }

        .image-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 500px;
            padding: 20px;
            background: 
                linear-gradient(45deg, var(--bg-tertiary) 25%, transparent 25%),
                linear-gradient(-45deg, var(--bg-tertiary) 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, var(--bg-tertiary) 75%),
                linear-gradient(-45deg, transparent 75%, var(--bg-tertiary) 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        #detection-image {
            max-width: 100%;
            max-height: 70vh;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            transition: opacity 0.3s ease;
        }

        #detection-image.loading {
            opacity: 0.5;
        }

        .loading-overlay {
            position: absolute;
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            color: var(--text-secondary);
        }

        .loading-overlay.show {
            display: flex;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-cyan);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ÂØºËà™ÊéßÂà∂ */
        .navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
            padding: 20px;
            border-top: 1px solid var(--border-color);
            background: var(--bg-tertiary);
        }

        .nav-btn {
            width: 48px;
            height: 48px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-btn:hover:not(:disabled) {
            background: var(--bg-primary);
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
            transform: translateY(-2px);
        }

        .nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .nav-input-group {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px 12px;
        }

        #index-input {
            width: 80px;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: 'JetBrains Mono', monospace;
            text-align: center;
            outline: none;
        }

        #index-input::-webkit-inner-spin-button,
        #index-input::-webkit-outer-spin-button {
            -webkit-appearance: none;
        }

        .nav-divider {
            color: var(--text-muted);
        }

        #total-count {
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        .jump-btn {
            padding: 8px 16px;
            background: var(--accent-cyan);
            border: none;
            border-radius: 6px;
            color: var(--bg-primary);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .jump-btn:hover {
            background: #79b8ff;
            transform: translateY(-1px);
        }

        /* ‰ø°ÊÅØÈù¢Êùø */
        .info-panel {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .info-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
        }

        .card-header {
            padding: 14px 16px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-header .icon {
            font-size: 1.1rem;
        }

        .card-content {
            padding: 16px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .info-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }

        .confidence-bar {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .confidence-track {
            width: 80px;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .confidence-fill.face { background: var(--face-color); }
        .confidence-fill.body { background: var(--body-color); }
        .confidence-fill.backup-face { background: var(--backup-face-color); }

        /* Âø´Êç∑ÈîÆÊèêÁ§∫ */
        .shortcuts-card .shortcut-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 0;
        }

        .key {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 32px;
            height: 28px;
            padding: 0 8px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .shortcut-desc {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        /* Áä∂ÊÄÅÊåáÁ§∫ */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-indicator.detected {
            background: rgba(63, 185, 80, 0.15);
            color: var(--accent-green);
        }

        .status-indicator.not-detected {
            background: rgba(139, 148, 158, 0.15);
            color: var(--text-secondary);
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
        }

        /* ÂìçÂ∫îÂºè */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .info-panel {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            .info-panel {
                grid-template-columns: 1fr;
            }

            .viewer-header {
                flex-direction: column;
                gap: 12px;
            }

            .image-path {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">üëÅÔ∏è</div>
                <h1>Ê£ÄÊµãÁªìÊûúÂèØËßÜÂåñ</h1>
            </div>
            <div class="dataset-info">
                <span>Êï∞ÊçÆÈõÜ:</span>
                <span class="dataset-badge">{{ target_folder }}</span>
                <span>ÂÖ± <strong>{{ total }}</strong> Âº†ÂõæÁâá</span>
            </div>
        </header>

        <div class="main-content">
            <div class="viewer-section">
                <div class="viewer-header">
                    <div class="image-path" id="image-path">Âä†ËΩΩ‰∏≠...</div>
                    <div class="viewer-controls">
                        <button class="toggle-btn face active" id="toggle-face" title="ÂàáÊç¢‰∫∫ËÑ∏Ê°Ü (F)">
                            <span class="color-dot face"></span>
                            ‰∫∫ËÑ∏
                        </button>
                        <button class="toggle-btn body active" id="toggle-body" title="ÂàáÊç¢‰∫∫‰ΩìÊ°Ü (B)">
                            <span class="color-dot body"></span>
                            ‰∫∫‰Ωì
                        </button>
                        <button class="toggle-btn keypoints active" id="toggle-keypoints" title="ÂàáÊç¢ÂÖ≥ÈîÆÁÇπ (K)">
                            <span class="color-dot keypoints"></span>
                            ÂÖ≥ÈîÆÁÇπ
                        </button>
                        <button class="toggle-btn backup-face active" id="toggle-backup-face" title="ÂàáÊç¢Â§áÈÄâ‰∫∫ËÑ∏Ê°Ü (U)">
                            <span class="color-dot backup-face"></span>
                            Â§áÈÄâ
                        </button>
                    </div>
                </div>

                <div class="image-container">
                    <div class="loading-overlay" id="loading">
                        <div class="spinner"></div>
                        <span>Âä†ËΩΩ‰∏≠...</span>
                    </div>
                    <img id="detection-image" src="" alt="Ê£ÄÊµãÁªìÊûú">
                </div>

                <div class="navigation">
                    <button class="nav-btn" id="btn-first" title="Á¨¨‰∏ÄÂº† (Home)">‚èÆ</button>
                    <button class="nav-btn" id="btn-prev" title="‰∏ä‰∏ÄÂº† (‚Üê)">‚óÄ</button>
                    
                    <div class="nav-input-group">
                        <input type="number" id="index-input" value="1" min="1" max="{{ total }}">
                        <span class="nav-divider">/</span>
                        <span id="total-count">{{ total }}</span>
                    </div>
                    
                    <button class="jump-btn" id="btn-jump">Ë∑≥ËΩ¨</button>
                    
                    <button class="nav-btn" id="btn-next" title="‰∏ã‰∏ÄÂº† (‚Üí)">‚ñ∂</button>
                    <button class="nav-btn" id="btn-last" title="ÊúÄÂêé‰∏ÄÂº† (End)">‚è≠</button>
                </div>
            </div>

            <div class="info-panel">
                <div class="info-card">
                    <div class="card-header">
                        <span class="icon">üì∑</span>
                        ÂõæÁâá‰ø°ÊÅØ
                    </div>
                    <div class="card-content">
                        <div class="info-row">
                            <span class="info-label">Â∞∫ÂØ∏</span>
                            <span class="info-value" id="image-size">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Á¥¢Âºï</span>
                            <span class="info-value" id="current-index">-</span>
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <div class="card-header">
                        <span class="icon" style="color: var(--face-color);">üë§</span>
                        ‰∫∫ËÑ∏Ê£ÄÊµã
                    </div>
                    <div class="card-content">
                        <div class="info-row">
                            <span class="info-label">Áä∂ÊÄÅ</span>
                            <span id="face-status" class="status-indicator not-detected">
                                <span class="status-dot"></span>
                                Êú™Ê£ÄÊµãÂà∞
                            </span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ÁΩÆ‰ø°Â∫¶</span>
                            <div class="confidence-bar">
                                <div class="confidence-track">
                                    <div class="confidence-fill face" id="face-confidence-bar" style="width: 0%"></div>
                                </div>
                                <span class="info-value" id="face-confidence">-</span>
                            </div>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ËæπÁïåÊ°Ü</span>
                            <span class="info-value" id="face-bbox">-</span>
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <div class="card-header">
                        <span class="icon" style="color: var(--body-color);">üßç</span>
                        ‰∫∫‰ΩìÊ£ÄÊµã
                    </div>
                    <div class="card-content">
                        <div class="info-row">
                            <span class="info-label">Áä∂ÊÄÅ</span>
                            <span id="body-status" class="status-indicator not-detected">
                                <span class="status-dot"></span>
                                Êú™Ê£ÄÊµãÂà∞
                            </span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ÁΩÆ‰ø°Â∫¶</span>
                            <div class="confidence-bar">
                                <div class="confidence-track">
                                    <div class="confidence-fill body" id="body-confidence-bar" style="width: 0%"></div>
                                </div>
                                <span class="info-value" id="body-confidence">-</span>
                            </div>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ËæπÁïåÊ°Ü</span>
                            <span class="info-value" id="body-bbox">-</span>
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <div class="card-header">
                        <span class="icon" style="color: var(--backup-face-color);">üë§</span>
                        Â§áÈÄâ‰∫∫ËÑ∏
                    </div>
                    <div class="card-content">
                        <div class="info-row">
                            <span class="info-label">Áä∂ÊÄÅ</span>
                            <span id="backup-face-status" class="status-indicator not-detected">
                                <span class="status-dot"></span>
                                Êú™Ê£ÄÊµãÂà∞
                            </span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ÁΩÆ‰ø°Â∫¶</span>
                            <div class="confidence-bar">
                                <div class="confidence-track">
                                    <div class="confidence-fill backup-face" id="backup-face-confidence-bar" style="width: 0%"></div>
                                </div>
                                <span class="info-value" id="backup-face-confidence">-</span>
                            </div>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ËæπÁïåÊ°Ü</span>
                            <span class="info-value" id="backup-face-bbox">-</span>
                        </div>
                    </div>
                </div>

                <div class="info-card shortcuts-card">
                    <div class="card-header">
                        <span class="icon">‚å®Ô∏è</span>
                        Âø´Êç∑ÈîÆ
                    </div>
                    <div class="card-content">
                        <div class="shortcut-item">
                            <span class="key">‚Üê</span>
                            <span class="shortcut-desc">‰∏ä‰∏ÄÂº†</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="key">‚Üí</span>
                            <span class="shortcut-desc">‰∏ã‰∏ÄÂº†</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="key">F</span>
                            <span class="shortcut-desc">ÂàáÊç¢‰∫∫ËÑ∏Ê°Ü</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="key">B</span>
                            <span class="shortcut-desc">ÂàáÊç¢‰∫∫‰ΩìÊ°Ü</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="key">K</span>
                            <span class="shortcut-desc">ÂàáÊç¢ÂÖ≥ÈîÆÁÇπ</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="key">U</span>
                            <span class="shortcut-desc">ÂàáÊç¢Â§áÈÄâ‰∫∫ËÑ∏</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="key">Home</span>
                            <span class="shortcut-desc">Á¨¨‰∏ÄÂº†</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="key">End</span>
                            <span class="shortcut-desc">ÊúÄÂêé‰∏ÄÂº†</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Áä∂ÊÄÅ
        const state = {
            currentIndex: 0,
            total: {{ total }},
            targetFolder: '{{ target_folder }}',
            showFace: true,
            showBody: true,
            showKeypoints: true,
            showBackupFace: true,
            loading: false
        };

        // DOM ÂÖÉÁ¥†
        const elements = {
            image: document.getElementById('detection-image'),
            imagePath: document.getElementById('image-path'),
            indexInput: document.getElementById('index-input'),
            loading: document.getElementById('loading'),
            
            // ÂØºËà™ÊåâÈíÆ
            btnFirst: document.getElementById('btn-first'),
            btnPrev: document.getElementById('btn-prev'),
            btnNext: document.getElementById('btn-next'),
            btnLast: document.getElementById('btn-last'),
            btnJump: document.getElementById('btn-jump'),
            
            // ÂàáÊç¢ÊåâÈíÆ
            toggleFace: document.getElementById('toggle-face'),
            toggleBody: document.getElementById('toggle-body'),
            toggleKeypoints: document.getElementById('toggle-keypoints'),
            toggleBackupFace: document.getElementById('toggle-backup-face'),
            
            // ‰ø°ÊÅØÊòæÁ§∫
            imageSize: document.getElementById('image-size'),
            currentIndex: document.getElementById('current-index'),
            faceStatus: document.getElementById('face-status'),
            faceConfidence: document.getElementById('face-confidence'),
            faceConfidenceBar: document.getElementById('face-confidence-bar'),
            faceBbox: document.getElementById('face-bbox'),
            bodyStatus: document.getElementById('body-status'),
            bodyConfidence: document.getElementById('body-confidence'),
            bodyConfidenceBar: document.getElementById('body-confidence-bar'),
            bodyBbox: document.getElementById('body-bbox'),
            backupFaceStatus: document.getElementById('backup-face-status'),
            backupFaceConfidence: document.getElementById('backup-face-confidence'),
            backupFaceConfidenceBar: document.getElementById('backup-face-confidence-bar'),
            backupFaceBbox: document.getElementById('backup-face-bbox')
        };

        // ÊûÑÂª∫ÂõæÁâá URL
        function getImageUrl(index) {
            return `/api/image/${index}?folder=${state.targetFolder}&face=${state.showFace}&body=${state.showBody}&keypoints=${state.showKeypoints}&backup_face=${state.showBackupFace}&t=${Date.now()}`;
        }

        // Âä†ËΩΩÂõæÁâá
        async function loadImage(index) {
            if (index < 0 || index >= state.total || state.loading) return;
            
            state.loading = true;
            state.currentIndex = index;
            
            elements.loading.classList.add('show');
            elements.image.classList.add('loading');
            
            // Êõ¥Êñ∞ËæìÂÖ•Ê°Ü
            elements.indexInput.value = index + 1;
            elements.currentIndex.textContent = `${index + 1} / ${state.total}`;
            
            // Âä†ËΩΩÊ£ÄÊµãÁªìÊûú‰ø°ÊÅØ
            try {
                const response = await fetch(`/api/result/${index}?folder=${state.targetFolder}`);
                const data = await response.json();
                
                if (data.result) {
                    updateInfo(data.result);
                }
            } catch (error) {
                console.error('Ëé∑ÂèñÊ£ÄÊµãÁªìÊûúÂ§±Ë¥•:', error);
            }
            
            // Âä†ËΩΩÂõæÁâá
            const newImage = new Image();
            newImage.onload = () => {
                elements.image.src = newImage.src;
                elements.loading.classList.remove('show');
                elements.image.classList.remove('loading');
                state.loading = false;
                updateNavButtons();
            };
            newImage.onerror = () => {
                elements.loading.classList.remove('show');
                elements.image.classList.remove('loading');
                state.loading = false;
            };
            newImage.src = getImageUrl(index);
        }

        // Êõ¥Êñ∞‰ø°ÊÅØÈù¢Êùø
        function updateInfo(result) {
            // ÂõæÁâáË∑ØÂæÑ
            elements.imagePath.textContent = result.image_path || '-';
            elements.imagePath.title = result.image_path || '';
            
            // ÂõæÁâáÂ∞∫ÂØ∏
            if (result.image_width && result.image_height) {
                elements.imageSize.textContent = `${result.image_width} √ó ${result.image_height}`;
            } else {
                elements.imageSize.textContent = '-';
            }
            
            // ‰∫∫ËÑ∏Ê£ÄÊµã
            if (result.face_bbox) {
                elements.faceStatus.className = 'status-indicator detected';
                elements.faceStatus.innerHTML = '<span class="status-dot"></span>Â∑≤Ê£ÄÊµã';
                
                const conf = result.face_confidence || 0;
                elements.faceConfidence.textContent = (conf * 100).toFixed(1) + '%';
                elements.faceConfidenceBar.style.width = (conf * 100) + '%';
                
                const bbox = result.face_bbox;
                elements.faceBbox.textContent = `(${(bbox.x_min * 100).toFixed(0)}%, ${(bbox.y_min * 100).toFixed(0)}%)`;
            } else {
                elements.faceStatus.className = 'status-indicator not-detected';
                elements.faceStatus.innerHTML = '<span class="status-dot"></span>Êú™Ê£ÄÊµãÂà∞';
                elements.faceConfidence.textContent = '-';
                elements.faceConfidenceBar.style.width = '0%';
                elements.faceBbox.textContent = '-';
            }
            
            // ‰∫∫‰ΩìÊ£ÄÊµã
            if (result.body_bbox) {
                elements.bodyStatus.className = 'status-indicator detected';
                elements.bodyStatus.innerHTML = '<span class="status-dot"></span>Â∑≤Ê£ÄÊµã';
                
                const conf = result.body_confidence || 0;
                elements.bodyConfidence.textContent = (conf * 100).toFixed(1) + '%';
                elements.bodyConfidenceBar.style.width = (conf * 100) + '%';
                
                const bbox = result.body_bbox;
                elements.bodyBbox.textContent = `(${(bbox.x_min * 100).toFixed(0)}%, ${(bbox.y_min * 100).toFixed(0)}%)`;
            } else {
                elements.bodyStatus.className = 'status-indicator not-detected';
                elements.bodyStatus.innerHTML = '<span class="status-dot"></span>Êú™Ê£ÄÊµãÂà∞';
                elements.bodyConfidence.textContent = '-';
                elements.bodyConfidenceBar.style.width = '0%';
                elements.bodyBbox.textContent = '-';
            }
            
            // Â§áÈÄâ‰∫∫ËÑ∏Ê£ÄÊµã
            if (result.backup_face_bbox) {
                elements.backupFaceStatus.className = 'status-indicator detected';
                elements.backupFaceStatus.innerHTML = '<span class="status-dot"></span>Â∑≤Ê£ÄÊµã';
                
                const conf = result.backup_face_confidence || 0;
                elements.backupFaceConfidence.textContent = (conf * 100).toFixed(1) + '%';
                elements.backupFaceConfidenceBar.style.width = (conf * 100) + '%';
                
                const bbox = result.backup_face_bbox;
                elements.backupFaceBbox.textContent = `(${(bbox.x_min * 100).toFixed(0)}%, ${(bbox.y_min * 100).toFixed(0)}%)`;
            } else {
                elements.backupFaceStatus.className = 'status-indicator not-detected';
                elements.backupFaceStatus.innerHTML = '<span class="status-dot"></span>Êú™Ê£ÄÊµãÂà∞';
                elements.backupFaceConfidence.textContent = '-';
                elements.backupFaceConfidenceBar.style.width = '0%';
                elements.backupFaceBbox.textContent = '-';
            }
        }

        // Êõ¥Êñ∞ÂØºËà™ÊåâÈíÆÁä∂ÊÄÅ
        function updateNavButtons() {
            elements.btnFirst.disabled = state.currentIndex === 0;
            elements.btnPrev.disabled = state.currentIndex === 0;
            elements.btnNext.disabled = state.currentIndex >= state.total - 1;
            elements.btnLast.disabled = state.currentIndex >= state.total - 1;
        }

        // Âà∑Êñ∞ÂΩìÂâçÂõæÁâáÔºàÂàáÊç¢ÊòæÁ§∫ÈÄâÈ°πÂêéÔºâ
        function refreshImage() {
            if (!state.loading) {
                elements.image.src = getImageUrl(state.currentIndex);
            }
        }

        // ÂàáÊç¢ÊåâÈíÆÂ§ÑÁêÜ
        function setupToggleButton(button, stateKey) {
            button.addEventListener('click', () => {
                state[stateKey] = !state[stateKey];
                button.classList.toggle('active', state[stateKey]);
                refreshImage();
            });
        }

        // ÂàùÂßãÂåñ
        function init() {
            // ÂØºËà™ÊåâÈíÆ‰∫ã‰ª∂
            elements.btnFirst.addEventListener('click', () => loadImage(0));
            elements.btnPrev.addEventListener('click', () => loadImage(state.currentIndex - 1));
            elements.btnNext.addEventListener('click', () => loadImage(state.currentIndex + 1));
            elements.btnLast.addEventListener('click', () => loadImage(state.total - 1));
            
            elements.btnJump.addEventListener('click', () => {
                const index = parseInt(elements.indexInput.value) - 1;
                if (index >= 0 && index < state.total) {
                    loadImage(index);
                }
            });
            
            elements.indexInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const index = parseInt(elements.indexInput.value) - 1;
                    if (index >= 0 && index < state.total) {
                        loadImage(index);
                    }
                }
            });
            
            // ÂàáÊç¢ÊåâÈíÆ‰∫ã‰ª∂
            setupToggleButton(elements.toggleFace, 'showFace');
            setupToggleButton(elements.toggleBody, 'showBody');
            setupToggleButton(elements.toggleKeypoints, 'showKeypoints');
            setupToggleButton(elements.toggleBackupFace, 'showBackupFace');
            
            // ÈîÆÁõòÂø´Êç∑ÈîÆ
            document.addEventListener('keydown', (e) => {
                // Â¶ÇÊûúÂú®ËæìÂÖ•Ê°Ü‰∏≠ÔºåÂøΩÁï•Âø´Êç∑ÈîÆÔºàÈô§‰∫Ü EnterÔºâ
                if (e.target.tagName === 'INPUT' && e.key !== 'Enter') return;
                
                switch (e.key) {
                    case 'ArrowLeft':
                        e.preventDefault();
                        loadImage(state.currentIndex - 1);
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        loadImage(state.currentIndex + 1);
                        break;
                    case 'Home':
                        e.preventDefault();
                        loadImage(0);
                        break;
                    case 'End':
                        e.preventDefault();
                        loadImage(state.total - 1);
                        break;
                    case 'f':
                    case 'F':
                        elements.toggleFace.click();
                        break;
                    case 'b':
                    case 'B':
                        elements.toggleBody.click();
                        break;
                    case 'k':
                    case 'K':
                        elements.toggleKeypoints.click();
                        break;
                    case 'u':
                    case 'U':
                        elements.toggleBackupFace.click();
                        break;
                }
            });
            
            // Âä†ËΩΩÁ¨¨‰∏ÄÂº†ÂõæÁâá
            if (state.total > 0) {
                loadImage(0);
            }
        }

        // ÂêØÂä®
        init();
    </script>
</body>
</html>

